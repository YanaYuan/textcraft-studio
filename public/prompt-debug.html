<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Promptè°ƒè¯•å·¥å…·</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #ff6b6b 0%, #ffd93d 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            min-height: 600px;
        }

        .config-section {
            padding: 30px;
            background: #f8f9fa;
            border-right: 1px solid #e9ecef;
            overflow-y: auto;
            max-height: 80vh;
        }

        .test-section {
            padding: 30px;
            background: white;
            display: flex;
            flex-direction: column;
        }

        .form-group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
            font-size: 14px;
        }

        textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 14px;
            font-family: 'Courier New', monospace;
            resize: vertical;
            transition: border-color 0.3s ease;
            line-height: 1.5;
        }

        textarea:focus {
            outline: none;
            border-color: #ff6b6b;
            box-shadow: 0 0 0 3px rgba(255, 107, 107, 0.1);
        }

        .textarea-small {
            min-height: 100px;
        }

        .textarea-medium {
            min-height: 200px;
        }

        .textarea-large {
            min-height: 300px;
        }

        .btn {
            background: linear-gradient(135deg, #ff6b6b 0%, #ffd93d 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(255, 107, 107, 0.3);
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-secondary:hover {
            background: #5a6268;
            box-shadow: 0 8px 16px rgba(108, 117, 125, 0.3);
        }

        .btn-success {
            background: #28a745;
        }

        .btn-success:hover {
            background: #218838;
            box-shadow: 0 8px 16px rgba(40, 167, 69, 0.3);
        }

        .status {
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-weight: 500;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .test-area {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .test-input {
            margin-bottom: 15px;
        }

        .test-input input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 14px;
        }

        .test-input input:focus {
            outline: none;
            border-color: #ff6b6b;
        }

        .preview-area {
            flex: 1;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            background: #f8f9fa;
            padding: 20px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            line-height: 1.4;
            white-space: pre-wrap;
            overflow-y: auto;
            max-height: 400px;
        }

        .actions {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }

        .quick-presets {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }

        .preset-btn {
            padding: 8px 12px;
            background: #e9ecef;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }

        .preset-btn:hover {
            background: #ff6b6b;
            color: white;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .config-section {
                border-right: none;
                border-bottom: 1px solid #e9ecef;
                max-height: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ› ï¸ Promptè°ƒè¯•å·¥å…·</h1>
            <p>å®æ—¶ä¿®æ”¹å’Œæµ‹è¯•AIæç¤ºè¯ï¼Œæå‡ç½‘é¡µç”Ÿæˆæ•ˆæœ</p>
        </div>

        <div class="main-content">
            <div class="config-section">
                <h3 style="margin-bottom: 20px; color: #333;">ğŸ“ Prompté…ç½®</h3>
                
                <div class="quick-presets">
                    <button class="preset-btn" onclick="loadPreset('default')">é»˜è®¤é…ç½®</button>
                    <button class="preset-btn" onclick="loadPreset('detailed')">è¯¦ç»†æ¨¡å¼</button>
                    <button class="preset-btn" onclick="loadPreset('minimal')">ç®€çº¦æ¨¡å¼</button>
                    <button class="preset-btn" onclick="loadPreset('creative')">åˆ›æ„æ¨¡å¼</button>
                    <button class="preset-btn" onclick="saveCustomPreset()">ğŸ’¾ ä¿å­˜å½“å‰ä¸ºè‡ªå®šä¹‰</button>
                    <button class="preset-btn" onclick="loadCustomPreset()">ğŸ“‚ åŠ è½½è‡ªå®šä¹‰</button>
                </div>

                <div class="form-group">
                    <label for="systemRole">ç³»ç»Ÿè§’è‰² (System Role):</label>
                    <textarea id="systemRole" class="textarea-small" placeholder="å®šä¹‰AIçš„è§’è‰²å’Œè¡Œä¸º..."></textarea>
                </div>

                <div class="form-group">
                    <label for="basePrompt">åŸºç¡€æç¤ºè¯ (Base Prompt):</label>
                    <textarea id="basePrompt" class="textarea-large" placeholder="æ ¸å¿ƒçš„ç½‘é¡µç”ŸæˆæŒ‡ä»¤..."></textarea>
                </div>

                <div class="form-group">
                    <label for="imagePrompt">å›¾ç‰‡æç¤ºè¯ (Image Prompt):</label>
                    <textarea id="imagePrompt" class="textarea-medium" placeholder="åŒ…å«å›¾ç‰‡æ—¶çš„é¢å¤–æŒ‡ä»¤..."></textarea>
                </div>

                <div class="form-group">
                    <label for="endPrompt">ç»“æŸæç¤ºè¯ (End Prompt):</label>
                    <textarea id="endPrompt" class="textarea-small" placeholder="æœ€ç»ˆçš„æ ¼å¼è¦æ±‚..."></textarea>
                </div>

                <div class="actions">
                    <button class="btn" onclick="updatePromptConfig()">ğŸ’¾ ä¿å­˜é…ç½®</button>
                    <button class="btn btn-secondary" onclick="loadCurrentConfig()">ğŸ”„ é‡æ–°åŠ è½½</button>
                    <button class="btn btn-secondary" onclick="resetConfig()">ğŸ”¥ é‡ç½®ä¸ºé»˜è®¤</button>
                    <button class="btn btn-secondary" onclick="exportConfig()">ğŸ“¤ å¯¼å‡ºé…ç½®</button>
                    <input type="file" id="importInput" accept=".json" style="display: none;" onchange="importConfig(event)">
                    <button class="btn btn-secondary" onclick="document.getElementById('importInput').click()">ğŸ“¥ å¯¼å…¥é…ç½®</button>
                </div>

                <div id="configStatus"></div>
            </div>

            <div class="test-section">
                <h3 style="margin-bottom: 20px; color: #333;">ğŸ§ª å®æ—¶æµ‹è¯•</h3>
                
                <div class="test-input">
                    <label for="testText">æµ‹è¯•æ–‡æœ¬:</label>
                    <input type="text" id="testText" placeholder="è¾“å…¥è¦æµ‹è¯•çš„æ–‡æœ¬å†…å®¹..." value="æ¬¢è¿æ¥åˆ°æˆ‘çš„ä¸ªäººåšå®¢ï¼Œè¿™é‡Œåˆ†äº«ç¼–ç¨‹å¿ƒå¾—å’Œç”Ÿæ´»æ„Ÿæ‚Ÿã€‚">
                </div>

                <div class="actions">
                    <button class="btn btn-success" onclick="previewPrompt()">ğŸ‘ï¸ é¢„è§ˆå®Œæ•´Prompt</button>
                    <button class="btn" onclick="testGeneration()">ğŸš€ æµ‹è¯•ç”Ÿæˆ</button>
                    <button class="btn btn-secondary" onclick="analyzeTextAndSuggest()">ğŸ¯ æ™ºèƒ½æ¨èé…ç½®</button>
                </div>

                <div id="testStatus"></div>

                <div class="form-group">
                    <label>å®Œæ•´Prompté¢„è§ˆ:</label>
                    <div id="promptPreview" class="preview-area">ç‚¹å‡»"é¢„è§ˆå®Œæ•´Prompt"æŸ¥çœ‹...</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // é¢„è®¾é…ç½®
        const presets = {
            default: {
                systemRole: "ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„ç½‘é¡µè®¾è®¡å¸ˆï¼Œæ“…é•¿å°†æ–‡æœ¬å†…å®¹è½¬æ¢ä¸ºç¾è§‚çš„HTMLç½‘é¡µã€‚",
                basePrompt: `è¯·æ ¹æ®ä»¥ä¸‹æ–‡æœ¬å†…å®¹ï¼Œåˆ›å»ºä¸€ä¸ªHTMLç½‘é¡µæ¥å‘ˆç°è¿™æ®µè¯ã€‚è¦æ±‚ï¼š
1. è®¾è®¡ç¾è§‚ï¼Œç°ä»£ç®€çº¦é£æ ¼
2. å¦‚æœéœ€è¦çš„è¯ï¼Œæ·»åŠ çº¯è‰²å›¾æ ‡æ¥å¢å¼ºè§†è§‰æ•ˆæœï¼Œä¸è¦ä½¿ç”¨å½©è‰²å›¾æ ‡`,
                imagePrompt: `
3. åœ¨ç½‘é¡µä¸­ä½¿ç”¨å›¾ç‰‡ï¼Œå›¾ç‰‡URL: {imageUrl}
4. ç½‘é¡µçš„æ¯”ä¾‹æ˜¯16:9ï¼Œç”»å‡ºé¡µé¢è¾¹æ¡†`,
                endPrompt: `. è¯·ç›´æ¥è¿”å›å®Œæ•´çš„HTMLä»£ç ï¼Œä»<!DOCTYPE html>å¼€å§‹ï¼Œä¸è¦æ·»åŠ ä»»ä½•è§£é‡Šæ–‡å­—æˆ–markdownæ ¼å¼`
            },
            detailed: {
                systemRole: "ä½ æ˜¯ä¸€ä¸ªèµ„æ·±çš„å‰ç«¯å¼€å‘å·¥ç¨‹å¸ˆå’ŒUI/UXè®¾è®¡å¸ˆï¼Œç²¾é€šHTML5ã€CSS3å’Œç°ä»£ç½‘é¡µè®¾è®¡è¶‹åŠ¿ã€‚ä½ èƒ½åˆ›é€ å‡ºæ—¢ç¾è§‚åˆå®ç”¨çš„ç½‘é¡µã€‚",
                basePrompt: `è¯·æ ¹æ®ä»¥ä¸‹æ–‡æœ¬å†…å®¹ï¼Œåˆ›å»ºä¸€ä¸ªç²¾ç¾çš„HTMLç½‘é¡µã€‚å…·ä½“è¦æ±‚ï¼š
1. ä½¿ç”¨ç°ä»£åŒ–çš„è®¾è®¡è¯­è¨€ï¼Œé‡‡ç”¨å¡ç‰‡å¼å¸ƒå±€
2. é…è‰²æ–¹æ¡ˆè¦å’Œè°ï¼Œä½¿ç”¨æ¸å˜èƒŒæ™¯æˆ–çº¯è‰²èƒŒæ™¯
3. æ–‡å­—æ’ç‰ˆè¦æœ‰å±‚æ¬¡æ„Ÿï¼Œåˆç†ä½¿ç”¨æ ‡é¢˜ã€å‰¯æ ‡é¢˜ã€æ­£æ–‡
4. æ·»åŠ é€‚å½“çš„é—´è·å’Œç•™ç™½ï¼Œæå‡è§†è§‰ä½“éªŒ
5. ä½¿ç”¨CSS3åŠ¨ç”»å’Œè¿‡æ¸¡æ•ˆæœå¢å¼ºäº¤äº’æ„Ÿ
6. å“åº”å¼è®¾è®¡ï¼Œé€‚é…ä¸åŒå±å¹•å°ºå¯¸
7. æ·»åŠ çº¯è‰²å›¾æ ‡(Font Awesomeæˆ–Unicodeç¬¦å·)æ¥å¢å¼ºè§†è§‰æ•ˆæœ`,
                imagePrompt: `
8. ä¼˜é›…åœ°é›†æˆæä¾›çš„å›¾ç‰‡ï¼Œå›¾ç‰‡URL: {imageUrl}
9. å›¾ç‰‡è¦æœ‰åœ†è§’ã€é˜´å½±ç­‰ç°ä»£åŒ–æ•ˆæœ
10. æ•´ä½“ç½‘é¡µæ¯”ä¾‹ä¸º16:9ï¼Œé€‚åˆå¤§å±å±•ç¤º`,
                endPrompt: `. è¿”å›å®Œæ•´çš„HTMLä»£ç ï¼ŒåŒ…å«æ‰€æœ‰CSSæ ·å¼ï¼Œç¡®ä¿å¯ä»¥ç›´æ¥åœ¨æµè§ˆå™¨ä¸­è¿è¡Œã€‚ä¸è¦æ·»åŠ ä»»ä½•markdownæ ¼å¼æˆ–è§£é‡Šæ–‡å­—ã€‚`
            },
            minimal: {
                systemRole: "ä½ æ˜¯ä¸€ä¸ªç®€çº¦ä¸»ä¹‰è®¾è®¡å¸ˆï¼Œæ“…é•¿åˆ›å»ºå¹²å‡€ã€ç®€æ´ä½†ä¸å¤±ç¾æ„Ÿçš„ç½‘é¡µã€‚",
                basePrompt: `åˆ›å»ºä¸€ä¸ªæç®€é£æ ¼çš„HTMLç½‘é¡µï¼š
1. å¤§é‡ç•™ç™½ï¼Œç®€æ´å¸ƒå±€
2. é»‘ç™½æˆ–å•è‰²é…è‰²æ–¹æ¡ˆ
3. ç®€å•çš„å‡ ä½•å½¢çŠ¶å’Œçº¿æ¡`,
                imagePrompt: `
4. å›¾ç‰‡ä»¥ç®€çº¦æ–¹å¼å±•ç¤º: {imageUrl}`,
                endPrompt: `. è¿”å›çº¯HTMLä»£ç ï¼Œæ— éœ€è§£é‡Šã€‚`
            },
            creative: {
                systemRole: "ä½ æ˜¯ä¸€ä¸ªå……æ»¡åˆ›æ„çš„æ•°å­—è‰ºæœ¯å®¶ï¼Œå–„äºå°†æ–‡å­—è½¬åŒ–ä¸ºå¯Œæœ‰è‰ºæœ¯æ„Ÿå’Œåˆ›æ„çš„è§†è§‰ä½œå“ã€‚",
                basePrompt: `ä¸ºä»¥ä¸‹æ–‡æœ¬åˆ›å»ºä¸€ä¸ªå¯Œæœ‰åˆ›æ„å’Œè‰ºæœ¯æ„Ÿçš„ç½‘é¡µï¼š
1. å¤§èƒ†çš„è‰²å½©æ­é…å’Œè§†è§‰å…ƒç´ 
2. åˆ›æ–°çš„å¸ƒå±€è®¾è®¡ï¼Œæ‰“ç ´ä¼ ç»Ÿæ ¼å±€
3. ä½¿ç”¨CSSåŠ¨ç”»å’Œç‰¹æ•ˆåˆ›é€ åŠ¨æ€æ•ˆæœ
4. è‰ºæœ¯åŒ–çš„å­—ä½“å’Œæ’ç‰ˆ
5. ç‹¬ç‰¹çš„è§†è§‰å±‚æ¬¡å’Œç©ºé—´æ„Ÿ`,
                imagePrompt: `
6. åˆ›æ„æ€§åœ°èå…¥å›¾ç‰‡: {imageUrl}
7. ä¸ºå›¾ç‰‡æ·»åŠ è‰ºæœ¯æ»¤é•œæˆ–æ•ˆæœ`,
                endPrompt: `. åˆ›é€ ä¸€ä¸ªä»¤äººå°è±¡æ·±åˆ»çš„è‰ºæœ¯åŒ–ç½‘é¡µï¼Œè¿”å›å®Œæ•´HTMLä»£ç ã€‚`
            }
        };

        // é¡µé¢åŠ è½½æ—¶è·å–å½“å‰é…ç½®
        document.addEventListener('DOMContentLoaded', function() {
            loadCurrentConfig();
        });

        // åŠ è½½é¢„è®¾é…ç½®
        function loadPreset(presetName) {
            const preset = presets[presetName];
            if (preset) {
                document.getElementById('systemRole').value = preset.systemRole;
                document.getElementById('basePrompt').value = preset.basePrompt;
                document.getElementById('imagePrompt').value = preset.imagePrompt;
                document.getElementById('endPrompt').value = preset.endPrompt;
                
                showStatus('configStatus', `å·²åŠ è½½${presetName}é¢„è®¾é…ç½®`, 'info');
            }
        }

        // åŠ è½½å½“å‰æœåŠ¡å™¨é…ç½®
        async function loadCurrentConfig() {
            try {
                const response = await fetch('/api/debug/get-prompt');
                const data = await response.json();
                
                if (data.success) {
                    const config = data.config;
                    document.getElementById('systemRole').value = config.systemRole;
                    document.getElementById('basePrompt').value = config.basePrompt;
                    document.getElementById('imagePrompt').value = config.imagePrompt;
                    document.getElementById('endPrompt').value = config.endPrompt;
                    
                    showStatus('configStatus', 'âœ… å·²åŠ è½½å½“å‰æœåŠ¡å™¨é…ç½®', 'success');
                }
            } catch (error) {
                showStatus('configStatus', 'âŒ åŠ è½½é…ç½®å¤±è´¥: ' + error.message, 'error');
            }
        }

        // æ›´æ–°æœåŠ¡å™¨é…ç½®
        async function updatePromptConfig() {
            const config = {
                systemRole: document.getElementById('systemRole').value,
                basePrompt: document.getElementById('basePrompt').value,
                imagePrompt: document.getElementById('imagePrompt').value,
                endPrompt: document.getElementById('endPrompt').value
            };

            try {
                const response = await fetch('/api/debug/update-prompt', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(config)
                });

                const data = await response.json();
                
                if (data.success) {
                    showStatus('configStatus', 'âœ… é…ç½®å·²ä¿å­˜åˆ°æœåŠ¡å™¨', 'success');
                } else {
                    throw new Error(data.error || 'æ›´æ–°å¤±è´¥');
                }
            } catch (error) {
                showStatus('configStatus', 'âŒ ä¿å­˜å¤±è´¥: ' + error.message, 'error');
            }
        }

        // é‡ç½®é…ç½®
        async function resetConfig() {
            try {
                const response = await fetch('/api/debug/reset-prompt', {
                    method: 'POST'
                });

                const data = await response.json();
                
                if (data.success) {
                    loadCurrentConfig();
                    showStatus('configStatus', 'âœ… å·²é‡ç½®ä¸ºé»˜è®¤é…ç½®', 'success');
                }
            } catch (error) {
                showStatus('configStatus', 'âŒ é‡ç½®å¤±è´¥: ' + error.message, 'error');
            }
        }

        // é¢„è§ˆå®Œæ•´Prompt
        function previewPrompt() {
            const testText = document.getElementById('testText').value || 'æµ‹è¯•æ–‡æœ¬å†…å®¹';
            const systemRole = document.getElementById('systemRole').value;
            const basePrompt = document.getElementById('basePrompt').value;
            const imagePrompt = document.getElementById('imagePrompt').value;
            const endPrompt = document.getElementById('endPrompt').value;

            // æ¨¡æ‹Ÿç”Ÿæˆå®Œæ•´prompt
            let fullPrompt = basePrompt;
            
            // å‡è®¾åŒ…å«å›¾ç‰‡
            const hasImage = true;
            if (hasImage) {
                fullPrompt += imagePrompt.replace('{imageUrl}', 'https://example.com/image.jpg');
            }
            
            const stepNumber = hasImage ? '4' : '3';
            fullPrompt += `\n${stepNumber}${endPrompt}\n\næ–‡æœ¬å†…å®¹ï¼š${testText}`;

            const previewContent = `=== ç³»ç»Ÿè§’è‰² ===\n${systemRole}\n\n=== ç”¨æˆ·æç¤ºè¯ ===\n${fullPrompt}`;
            
            document.getElementById('promptPreview').textContent = previewContent;
            showStatus('testStatus', 'ğŸ“‹ Prompté¢„è§ˆå·²ç”Ÿæˆ', 'info');
        }

        // æµ‹è¯•ç”Ÿæˆç½‘é¡µ
        async function testGeneration() {
            const testText = document.getElementById('testText').value;
            
            if (!testText.trim()) {
                showStatus('testStatus', 'âŒ è¯·è¾“å…¥æµ‹è¯•æ–‡æœ¬', 'error');
                return;
            }

            showStatus('testStatus', 'ğŸ”„ æ­£åœ¨æµ‹è¯•ç”Ÿæˆ...', 'info');

            try {
                const response = await fetch('/api/generate-webpage', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        text: testText,
                        imageOption: 'no' // å¿«é€Ÿæµ‹è¯•ï¼Œä¸ç”Ÿæˆå›¾ç‰‡
                    })
                });

                const data = await response.json();
                
                if (data.success) {
                    showStatus('testStatus', 'âœ… ç”ŸæˆæˆåŠŸï¼ç½‘é¡µå·²åˆ›å»º', 'success');
                    
                    // åœ¨æ–°çª—å£ä¸­æ‰“å¼€ç”Ÿæˆçš„ç½‘é¡µ
                    const newWindow = window.open();
                    newWindow.document.write(data.html);
                    newWindow.document.close();
                } else {
                    throw new Error(data.error || 'ç”Ÿæˆå¤±è´¥');
                }
            } catch (error) {
                showStatus('testStatus', 'âŒ æµ‹è¯•å¤±è´¥: ' + error.message, 'error');
            }
        }

        // æ˜¾ç¤ºçŠ¶æ€æ¶ˆæ¯
        function showStatus(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="status ${type}">${message}</div>`;
            
            // 3ç§’åæ¸…é™¤æ¶ˆæ¯
            setTimeout(() => {
                element.innerHTML = '';
            }, 3000);
        }

        // å¿«æ·é”®æ”¯æŒ
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey) {
                switch(e.key) {
                    case 's':
                        e.preventDefault();
                        updatePromptConfig();
                        break;
                    case 'Enter':
                        e.preventDefault();
                        testGeneration();
                        break;
                    case 'p':
                        e.preventDefault();
                        previewPrompt();
                        break;
                }
            }
        });

        // ä¿å­˜è‡ªå®šä¹‰é¢„è®¾
        function saveCustomPreset() {
            const config = {
                systemRole: document.getElementById('systemRole').value,
                basePrompt: document.getElementById('basePrompt').value,
                imagePrompt: document.getElementById('imagePrompt').value,
                endPrompt: document.getElementById('endPrompt').value
            };
            
            localStorage.setItem('customPromptPreset', JSON.stringify(config));
            showStatus('configStatus', 'âœ… è‡ªå®šä¹‰é¢„è®¾å·²ä¿å­˜åˆ°æœ¬åœ°', 'success');
        }

        // åŠ è½½è‡ªå®šä¹‰é¢„è®¾
        function loadCustomPreset() {
            const saved = localStorage.getItem('customPromptPreset');
            if (saved) {
                try {
                    const config = JSON.parse(saved);
                    document.getElementById('systemRole').value = config.systemRole || '';
                    document.getElementById('basePrompt').value = config.basePrompt || '';
                    document.getElementById('imagePrompt').value = config.imagePrompt || '';
                    document.getElementById('endPrompt').value = config.endPrompt || '';
                    
                    showStatus('configStatus', 'âœ… å·²åŠ è½½è‡ªå®šä¹‰é¢„è®¾', 'success');
                } catch (error) {
                    showStatus('configStatus', 'âŒ è‡ªå®šä¹‰é¢„è®¾æ ¼å¼é”™è¯¯', 'error');
                }
            } else {
                showStatus('configStatus', 'âš ï¸ æ²¡æœ‰ä¿å­˜çš„è‡ªå®šä¹‰é¢„è®¾', 'error');
            }
        }

        // å¯¼å‡ºé…ç½®
        function exportConfig() {
            const config = {
                systemRole: document.getElementById('systemRole').value,
                basePrompt: document.getElementById('basePrompt').value,
                imagePrompt: document.getElementById('imagePrompt').value,
                endPrompt: document.getElementById('endPrompt').value,
                exportTime: new Date().toISOString(),
                version: '1.0'
            };
            
            const blob = new Blob([JSON.stringify(config, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `prompt-config-${new Date().toISOString().slice(0, 10)}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showStatus('configStatus', 'âœ… é…ç½®å·²å¯¼å‡ºåˆ°æ–‡ä»¶', 'success');
        }

        // å¯¼å…¥é…ç½®
        function importConfig(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const config = JSON.parse(e.target.result);
                    
                    if (config.systemRole !== undefined) document.getElementById('systemRole').value = config.systemRole;
                    if (config.basePrompt !== undefined) document.getElementById('basePrompt').value = config.basePrompt;
                    if (config.imagePrompt !== undefined) document.getElementById('imagePrompt').value = config.imagePrompt;
                    if (config.endPrompt !== undefined) document.getElementById('endPrompt').value = config.endPrompt;
                    
                    showStatus('configStatus', 'âœ… é…ç½®å·²ä»æ–‡ä»¶å¯¼å…¥', 'success');
                } catch (error) {
                    showStatus('configStatus', 'âŒ é…ç½®æ–‡ä»¶æ ¼å¼é”™è¯¯', 'error');
                }
            };
            reader.readAsText(file);
        }

        // æ™ºèƒ½åˆ†ææ–‡æœ¬å¹¶æ¨èé…ç½®
        function analyzeTextAndSuggest() {
            const testText = document.getElementById('testText').value;
            if (!testText.trim()) {
                showStatus('testStatus', 'âŒ è¯·å…ˆè¾“å…¥æµ‹è¯•æ–‡æœ¬', 'error');
                return;
            }
            
            // ç®€å•çš„æ–‡æœ¬åˆ†æé€»è¾‘
            let suggestedPreset = 'default';
            
            if (testText.includes('äº§å“') || testText.includes('æœåŠ¡') || testText.includes('å…¬å¸')) {
                suggestedPreset = 'detailed';
            } else if (testText.includes('è¯—') || testText.includes('è‰ºæœ¯') || testText.includes('åˆ›æ„')) {
                suggestedPreset = 'creative';
            } else if (testText.length < 100) {
                suggestedPreset = 'minimal';
            }
            
            loadPreset(suggestedPreset);
            showStatus('testStatus', `ğŸ¯ æ ¹æ®æ–‡æœ¬å†…å®¹æ¨èä½¿ç”¨ "${suggestedPreset}" é¢„è®¾`, 'info');
        }
    </script>
</body>
</html>
